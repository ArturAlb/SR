# Block Tor directory authorities and relays
alert tcp any any -> any 9001 (msg:"TOR traffic detected - Directory Server"; flow:to_server; content:"dirreq"; threshold: type limit, track by_src, seconds 60, count 1; sid:1000001; rev:1;)
alert tcp any any -> any 9030 (msg:"TOR traffic detected - Directory Mirror"; flow:to_server; content:"dirreq"; threshold: type limit, track by_src, seconds 60, count 1; sid:1000002; rev:1;)
alert tcp any any -> any 443 (msg:"TOR traffic detected - Bridge"; flow:to_server; content:"bridge"; threshold: type limit, track by_src, seconds 60, count 1; sid:1000003; rev:1;)

# Block known Tor protocol patterns
alert tcp any any -> any any (msg:"TOR protocol handshake detected"; flow:established; content:"|00 03 00 01|"; depth:4; offset:0; sid:1000004; rev:1;)
alert tcp any any -> any any (msg:"TOR cell protocol detected"; flow:established; content:"|00 00|"; depth:2; offset:0; sid:1000005; rev:1;)

# Block DNS requests for .onion addresses
alert udp any any -> any 53 (msg:"TOR .onion DNS query"; content:"|06|onion|00|"; nocase; sid:1000006; rev:1;)
alert tcp any any -> any 53 (msg:"TOR .onion DNS query"; content:"|06|onion|00|"; nocase; sid:1000007; rev:1;)